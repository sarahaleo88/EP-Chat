<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Model Switching Validation Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .test-result {
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #0056b3;
        }
        .log-container {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 10px;
            max-height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <h1>üß™ Model Switching Functionality Validation</h1>
    
    <div class="test-container">
        <h2>Environment Check</h2>
        <div id="env-check"></div>
    </div>

    <div class="test-container">
        <h2>localStorage Test</h2>
        <button onclick="testLocalStorage()">Test localStorage</button>
        <div id="localStorage-result"></div>
    </div>

    <div class="test-container">
        <h2>Process.env Guard Test</h2>
        <button onclick="testProcessEnvGuard()">Test Environment Guards</button>
        <div id="process-env-result"></div>
    </div>

    <div class="test-container">
        <h2>Model State Simulation</h2>
        <button onclick="simulateModelChange('deepseek-chat')">üí¨ DeepSeek Chat</button>
        <button onclick="simulateModelChange('deepseek-coder')">üë®‚Äçüíª DeepSeek Coder</button>
        <button onclick="simulateModelChange('deepseek-reasoner')">üß† DeepSeek Reasoner</button>
        <div id="model-simulation-result"></div>
    </div>

    <div class="test-container">
        <h2>Console Logs</h2>
        <button onclick="clearLogs()">Clear Logs</button>
        <div id="console-logs" class="log-container"></div>
    </div>

    <script>
        // Capture console logs
        const originalConsoleLog = console.log;
        const originalConsoleError = console.error;
        const logs = [];

        function addLog(type, message) {
            const timestamp = new Date().toLocaleTimeString();
            logs.push(`[${timestamp}] ${type.toUpperCase()}: ${message}`);
            updateLogDisplay();
        }

        console.log = function(...args) {
            addLog('log', args.join(' '));
            originalConsoleLog.apply(console, args);
        };

        console.error = function(...args) {
            addLog('error', args.join(' '));
            originalConsoleError.apply(console, args);
        };

        function updateLogDisplay() {
            const logContainer = document.getElementById('console-logs');
            logContainer.innerHTML = logs.slice(-20).join('\n');
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        function clearLogs() {
            logs.length = 0;
            updateLogDisplay();
        }

        // Environment check
        function checkEnvironment() {
            const envCheck = document.getElementById('env-check');
            let results = [];

            // Check if process is defined
            const processExists = typeof process !== 'undefined';
            results.push(`<div class="${processExists ? 'error' : 'success'}">
                Process object exists: ${processExists} ${processExists ? '‚ùå (Should be undefined in browser)' : '‚úÖ'}
            </div>`);

            // Check localStorage
            const localStorageWorks = typeof localStorage !== 'undefined';
            results.push(`<div class="${localStorageWorks ? 'success' : 'error'}">
                localStorage available: ${localStorageWorks} ${localStorageWorks ? '‚úÖ' : '‚ùå'}
            </div>`);

            // Check if we're in browser
            const inBrowser = typeof window !== 'undefined';
            results.push(`<div class="${inBrowser ? 'success' : 'error'}">
                Running in browser: ${inBrowser} ${inBrowser ? '‚úÖ' : '‚ùå'}
            </div>`);

            envCheck.innerHTML = results.join('');
        }

        // Test localStorage functionality
        function testLocalStorage() {
            const result = document.getElementById('localStorage-result');
            try {
                const testKey = 'selected-model';
                const testValue = 'deepseek-chat';
                
                // Test write
                localStorage.setItem(testKey, testValue);
                
                // Test read
                const readValue = localStorage.getItem(testKey);
                
                if (readValue === testValue) {
                    result.innerHTML = '<div class="success">‚úÖ localStorage read/write test passed</div>';
                } else {
                    result.innerHTML = '<div class="error">‚ùå localStorage read/write test failed</div>';
                }
                
                // Clean up
                localStorage.removeItem(testKey);
            } catch (error) {
                result.innerHTML = `<div class="error">‚ùå localStorage test failed: ${error.message}</div>`;
            }
        }

        // Test process.env guards
        function testProcessEnvGuard() {
            const result = document.getElementById('process-env-result');
            let testResults = [];

            try {
                // Test the guard condition
                const guardCondition = typeof process !== 'undefined' && process.env?.NODE_ENV === 'development';
                testResults.push(`<div class="${guardCondition ? 'error' : 'success'}">
                    Environment guard condition: ${guardCondition} ${guardCondition ? '‚ùå (Should be false in browser)' : '‚úÖ'}
                </div>`);

                // Test safe access
                let safeAccess = false;
                try {
                    if (typeof process !== 'undefined' && process.env?.NODE_ENV === 'development') {
                        console.log('This should not execute in browser');
                        safeAccess = true;
                    }
                } catch (e) {
                    testResults.push(`<div class="error">‚ùå Guard failed: ${e.message}</div>`);
                }

                if (!safeAccess) {
                    testResults.push('<div class="success">‚úÖ Environment guard working correctly</div>');
                }

            } catch (error) {
                testResults.push(`<div class="error">‚ùå Process.env guard test failed: ${error.message}</div>`);
            }

            result.innerHTML = testResults.join('');
        }

        // Simulate model change
        function simulateModelChange(model) {
            const result = document.getElementById('model-simulation-result');
            
            try {
                console.log(`[ModelTest] Simulating model change to: ${model}`);
                
                // Simulate the useModelState hook behavior
                const STORAGE_KEY = 'selected-model';
                const previousModel = localStorage.getItem(STORAGE_KEY);
                
                console.log(`[ModelTest] Previous model: ${previousModel}`);
                console.log(`[ModelTest] New model: ${model}`);
                
                // Save to localStorage
                localStorage.setItem(STORAGE_KEY, model);
                
                // Verify save
                const savedModel = localStorage.getItem(STORAGE_KEY);
                
                if (savedModel === model) {
                    result.innerHTML = `<div class="success">‚úÖ Model changed successfully to: ${model}</div>`;
                    console.log(`[ModelTest] Model change successful: ${savedModel}`);
                } else {
                    result.innerHTML = `<div class="error">‚ùå Model change failed. Expected: ${model}, Got: ${savedModel}</div>`;
                }
                
            } catch (error) {
                result.innerHTML = `<div class="error">‚ùå Model simulation failed: ${error.message}</div>`;
                console.error(`[ModelTest] Error: ${error.message}`);
            }
        }

        // Initialize tests on page load
        window.addEventListener('load', function() {
            checkEnvironment();
            console.log('üß™ Model Switching Validation Test initialized');
        });
    </script>
</body>
</html>
